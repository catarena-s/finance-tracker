# План реализации: Frontend реализация

## Обзор

Этот план описывает пошаговую реализацию frontend приложения для трекера личных финансов на Next.js 14+ с TypeScript. Реализация включает создание всех компонентов UI, настройку роутинга, управление состоянием, API клиенты и интеграцию с backend. Каждая задача строится на предыдущих шагах и включает валидацию через тесты.

## Задачи

- [x] 1. Настройка структуры проекта и базовых интерфейсов
  - Создать структуру директорий (components, lib, types, app)
  - Настроить TypeScript конфигурацию
  - Определить базовые типы данных (Transaction, Category, Budget)
  - Настроить Tailwind CSS
  - Настроить тестовое окружение (Jest, React Testing Library, fast-check)
  - _Требования: Все требования_

- [ ] 2. Реализация утилитарных функций
  - [x] 2.1 Реализовать функции форматирования
    - Создать formatCurrency для форматирования денежных сумм
    - Создать formatDate для консистентного форматирования дат
    - Создать функции парсинга дат с учетом часовых поясов
    - _Требования: 6.1, 6.2, 14.3_
  
  - [ ]* 2.2 Написать property тест для formatCurrency
    - **Свойство 6: Денежные суммы форматируются консистентно**
    - **Валидирует: Требования 6.1**
  
  - [ ]* 2.3 Написать property тест для formatDate
    - **Свойство 7: Даты форматируются консистентно**
    - **Валидирует: Требования 6.2**
  
  - [ ]* 2.4 Написать property тест для парсинга дат
    - **Свойство 19: Парсинг дат обрабатывает часовой пояс корректно**
    - **Валидирует: Требования 14.3**

  - [x] 2.5 Реализовать функции валидации
    - Создать валидаторы для сумм (положительные, 2 десятичных знака)
    - Создать валидаторы для дат (валидный формат, не в будущем)
    - Создать валидаторы для строк (длина, обязательность)
    - Создать валидатор hex цветов
    - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_


- [ ] 3. Реализация API клиентов
  - [ ] 3.1 Создать базовый HTTP клиент
    - Настроить Axios с базовым URL и перехватчиками
    - Реализовать обработку ошибок для различных HTTP статусов
    - Реализовать механизм повтора для неудавшихся запросов
    - _Требования: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8_
  
  - [ ] 3.2 Реализовать Transaction API клиент
    - Создать методы getAll, getById, create, update, delete
    - Реализовать поддержку параметров фильтрации и пагинации
    - _Требования: 1.1, 1.3, 1.5, 1.6, 1.7_
  
  - [ ] 3.3 Реализовать Category API клиент
    - Создать методы getAll, getById, create, update, delete
    - Реализовать фильтрацию по типу категории
    - _Требования: 3.1, 3.2, 3.3, 3.6_
  
  - [ ] 3.4 Реализовать Budget API клиент
    - Создать методы getAll, getById, create, update, delete
    - _Требования: 4.1, 4.2, 4.3_
  
  - [ ] 3.5 Реализовать Analytics API клиент
    - Создать методы getSummary, getTrends, getTopCategories
    - _Требования: 5.1, 5.2, 5.3, 5.4, 5.5_
  
  - [ ]* 3.6 Написать property тест для round-trip данных
    - **Свойство 18: Round-trip данных API сохраняет значения**
    - **Валидирует: Требования 14.1**

- [ ] 4. Checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.

- [ ] 5. Реализация управления состоянием
  - [ ] 5.1 Создать App Context
    - Определить AppContextValue интерфейс
    - Реализовать AppProvider с состоянием для транзакций, категорий, бюджетов
    - Реализовать состояние для аналитики (summary, trends, topCategories)
    - Реализовать состояние UI (loading, error)
    - _Требования: Все требования_
  
  - [ ] 5.2 Реализовать функции управления транзакциями
    - Реализовать loadTransactions с поддержкой фильтров
    - Реализовать createTransaction с оптимистичным обновлением
    - Реализовать updateTransaction с оптимистичным обновлением
    - Реализовать deleteTransaction с оптимистичным обновлением
    - _Требования: 1.1, 1.3, 1.5, 1.6, 13.1, 13.2, 13.3, 13.4, 13.5_
  
  - [ ]* 5.3 Написать property тест для оптимистичных обновлений
    - **Свойство 16: Оптимистичные обновления применяются немедленно**
    - **Валидирует: Требования 13.1**
  
  - [ ]* 5.4 Написать property тест для отката оптимистичных обновлений
    - **Свойство 17: Неудавшиеся оптимистичные обновления откатываются**
    - **Валидирует: Требования 13.4**
  
  - [ ] 5.5 Реализовать функции управления категориями
    - Реализовать loadCategories с фильтрацией по типу
    - Реализовать createCategory с оптимистичным обновлением
    - Реализовать updateCategory с оптимистичным обновлением
    - Реализовать deleteCategory с оптимистичным обновлением
    - _Требования: 3.1, 3.2, 3.3, 3.6, 13.6_
  
  - [ ] 5.6 Реализовать функции управления бюджетами
    - Реализовать loadBudgets
    - Реализовать createBudget с оптимистичным обновлением
    - Реализовать updateBudget с оптимистичным обновлением
    - Реализовать deleteBudget с оптимистичным обновлением
    - _Требования: 4.1, 4.2, 4.3, 13.7_
  
  - [ ] 5.7 Реализовать функции аналитики
    - Реализовать loadSummary
    - Реализовать loadTrends
    - Реализовать loadTopCategories
    - _Требования: 5.1, 5.2, 5.3, 5.4, 5.5_


- [ ] 6. Реализация общих UI компонентов
  - [ ] 6.1 Создать Button компонент
    - Реализовать варианты (primary, secondary, danger, ghost)
    - Реализовать размеры (sm, md, lg)
    - Реализовать состояния (disabled, loading)
    - Добавить ARIA атрибуты для доступности
    - _Требования: 11.5, 11.8_
  
  - [ ]* 6.2 Написать unit тесты для Button
    - Тестировать рендеринг всех вариантов
    - Тестировать обработку кликов
    - Тестировать состояние loading
  
  - [ ] 6.3 Создать Input компонент
    - Реализовать типы (text, number, email, password)
    - Реализовать отображение label и ошибок
    - Добавить ARIA атрибуты (aria-invalid, aria-describedby)
    - _Требования: 11.6, 11.7_
  
  - [ ] 6.4 Создать Select компонент
    - Реализовать выпадающий список с опциями
    - Реализовать отображение label и ошибок
    - Добавить ARIA атрибуты
    - _Требования: 11.6_
  
  - [ ] 6.5 Создать DatePicker компонент
    - Реализовать ввод даты с календарем
    - Реализовать валидацию диапазона дат (minDate, maxDate)
    - Добавить поддержку мобильной клавиатуры
    - _Требования: 12.7_
  
  - [ ] 6.6 Создать CurrencyInput компонент
    - Реализовать специализированный ввод для денежных сумм
    - Реализовать форматирование с символом валюты
    - Реализовать валидацию числового ввода
    - Добавить поддержку мобильной числовой клавиатуры
    - _Требования: 12.7_
  
  - [ ] 6.7 Создать Modal компонент
    - Реализовать модальное окно с затемнением фона
    - Реализовать закрытие по клику на фон или ESC
    - Реализовать захват фокуса (focus trap)
    - Реализовать возврат фокуса при закрытии
    - _Требования: 11.1, 11.2, 11.3, 11.4_
  
  - [ ]* 6.8 Написать property тест для focus trap в Modal
    - **Свойство 14: Фокус модального окна захвачен**
    - **Валидирует: Требования 11.1**
  
  - [ ]* 6.9 Написать property тест для возврата фокуса в Modal
    - **Свойство 15: Закрытие модального окна возвращает фокус**
    - **Валидирует: Требования 11.3**
  
  - [ ] 6.10 Создать Pagination компонент
    - Реализовать отображение номеров страниц
    - Реализовать кнопки назад/вперед
    - Реализовать деактивацию кнопок на первой/последней странице
    - Реализовать отображение информации о пагинации
    - _Требования: 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_
  
  - [ ]* 6.11 Написать property тест для Pagination
    - **Свойство 12: Пагинация отображает корректные элементы на странице**
    - **Валидирует: Требования 10.1**

- [ ] 7. Checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.


- [ ] 8. Реализация компонентов транзакций
  - [ ] 8.1 Создать TransactionCard компонент
    - Реализовать отображение транзакции (тип, сумма, категория, дата, описание)
    - Реализовать цветовое кодирование по типу (зеленый/красный)
    - Реализовать кнопки редактирования и удаления
    - Адаптировать для мобильных устройств
    - _Требования: 6.3, 6.4, 12.5_
  
  - [ ] 8.2 Создать TransactionList компонент
    - Реализовать отображение списка TransactionCard
    - Интегрировать Pagination компонент
    - Реализовать состояния загрузки (скелетоны)
    - Реализовать пустое состояние
    - _Требования: 1.1, 9.2, 10.1_
  
  - [ ] 8.3 Создать TransactionFilters компонент
    - Реализовать селектор типа транзакции
    - Реализовать выпадающий список категорий
    - Реализовать выбор диапазона дат
    - Реализовать кнопку очистки фильтров
    - _Требования: 1.7, 2.1, 2.2, 2.3, 2.4, 2.5_
  
  - [ ]* 8.4 Написать property тест для фильтрации по типу
    - **Свойство 3: Фильтр по типу возвращает только соответствующие транзакции**
    - **Валидирует: Требования 2.1**
  
  - [ ]* 8.5 Написать property тест для фильтрации по категории
    - **Свойство 4: Фильтр по категории возвращает только транзакции этой категории**
    - **Валидирует: Требования 2.2**
  
  - [ ]* 8.6 Написать property тест для фильтрации по датам
    - **Свойство 5: Фильтр по диапазону дат возвращает только транзакции в диапазоне**
    - **Валидирует: Требования 2.3**
  
  - [ ]* 8.7 Написать property тест для сохранения фильтров при пагинации
    - **Свойство 13: Пагинация сохраняет фильтры при смене страниц**
    - **Валидирует: Требования 10.8**
  
  - [ ] 8.8 Создать TransactionForm компонент
    - Реализовать форму с полями (тип, сумма, категория, описание, дата)
    - Интегрировать React Hook Form для управления формой
    - Реализовать валидацию полей (on blur, on submit)
    - Реализовать отображение ошибок валидации
    - Реализовать состояние отправки (disabled button, spinner)
    - _Требования: 1.2, 1.3, 1.4, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.8, 7.9, 9.3_
  
  - [ ]* 8.9 Написать property тест для валидной отправки формы
    - **Свойство 1: Валидная отправка формы создает сущность**
    - **Валидирует: Требования 1.3, 7.8**
  
  - [ ]* 8.10 Написать property тест для валидации формы
    - **Свойство 2: Невалидные данные формы показывают специфичные для полей ошибки**
    - **Валидирует: Требования 1.4, 7.9**


- [ ] 9. Реализация компонентов категорий
  - [ ] 9.1 Создать CategoryCard компонент
    - Реализовать отображение категории (цвет, иконка, название, тип)
    - Реализовать кнопки редактирования и удаления
    - Адаптировать для мобильных устройств
    - _Требования: 3.1, 12.5_
  
  - [ ] 9.2 Создать CategoryList компонент
    - Реализовать сеточное отображение CategoryCard
    - Реализовать группировку по типу (доход/расход)
    - Реализовать состояния загрузки
    - Реализовать пустое состояние
    - _Требования: 3.1, 9.2_
  
  - [ ] 9.3 Создать CategoryForm компонент
    - Реализовать форму с полями (название, тип, цвет, иконка)
    - Реализовать палитру выбора цвета
    - Реализовать валидацию (название не пустое, цвет валидный hex, уникальность)
    - Реализовать отображение ошибок валидации
    - _Требования: 3.2, 3.3, 3.4, 3.5, 7.7_
  
  - [ ]* 9.4 Написать unit тест для предотвращения дубликатов категорий
    - Тестировать, что дублирующиеся имена отклоняются
    - _Требования: 3.4_

- [ ] 10. Реализация компонентов бюджетов
  - [ ] 10.1 Создать BudgetCard компонент
    - Реализовать отображение бюджета (категория, сумма, потрачено, период)
    - Реализовать прогресс-бар с цветовым кодированием (<70% зеленый, 70-90% желтый, >90% красный)
    - Реализовать отображение процента использования
    - Реализовать кнопки редактирования и удаления
    - _Требования: 4.1, 4.5, 4.6, 4.7, 4.8_
  
  - [ ]* 10.2 Написать property тест для предупреждений бюджета
    - **Свойство 8: Предупреждения бюджета появляются при превышении**
    - **Валидирует: Требования 4.5**
  
  - [ ]* 10.3 Написать property тест для расчета процента бюджета
    - **Свойство 9: Процент бюджета рассчитывается корректно**
    - **Валидирует: Требования 4.8**
  
  - [ ] 10.4 Создать BudgetList компонент
    - Реализовать отображение списка BudgetCard
    - Реализовать состояния загрузки
    - Реализовать пустое состояние
    - _Требования: 4.1, 9.2_
  
  - [ ] 10.5 Создать BudgetForm компонент
    - Реализовать форму с полями (категория, сумма, период, даты)
    - Реализовать валидацию (сумма > 0, даты валидны, end > start)
    - Реализовать отображение ошибок валидации
    - _Требования: 4.2, 4.3, 4.4, 7.2, 7.4_

- [ ] 11. Checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.


- [ ] 12. Реализация Dashboard компонентов
  - [ ] 12.1 Создать SummaryCards компонент
    - Реализовать три карточки (Доходы, Расходы, Баланс)
    - Реализовать цветовое кодирование (зеленый, красный, синий)
    - Реализовать форматирование сумм с валютой
    - Адаптировать для мобильных устройств (вертикальный стек)
    - _Требования: 5.1, 6.1, 12.5_
  
  - [ ] 12.2 Создать ExpenseChart компонент
    - Настроить Chart.js для линейного графика
    - Реализовать отображение трендов расходов
    - Реализовать переключатель периода (неделя/месяц/год)
    - Реализовать всплывающие подсказки с точными значениями
    - Реализовать адаптивный размер для мобильных устройств
    - _Требования: 5.2, 5.5, 6.6, 12.6_
  
  - [ ] 12.3 Создать TrendChart компонент
    - Реализовать двойной линейный график (доходы vs расходы)
    - Реализовать переключатель периода
    - Реализовать всплывающие подсказки
    - Реализовать адаптивный размер
    - _Требования: 5.3, 5.5, 6.6, 12.6_
  
  - [ ] 12.4 Создать TopCategoriesWidget компонент
    - Реализовать гистограмму топ категорий
    - Реализовать отображение процентов
    - Реализовать ограничение количества категорий
    - _Требования: 5.4_
  
  - [ ]* 12.5 Написать unit тесты для пустого состояния графиков
    - Тестировать отображение сообщения "Нет данных" для пустых графиков
    - _Требования: 5.7_
  
  - [ ] 12.6 Создать Dashboard страницу
    - Интегрировать все Dashboard компоненты
    - Реализовать загрузку данных аналитики при монтировании
    - Реализовать состояния загрузки (скелетоны)
    - Реализовать обработку ошибок
    - _Требования: 5.1, 5.2, 5.3, 5.4, 5.6, 9.1_

- [ ] 13. Реализация Layout компонентов
  - [ ] 13.1 Создать Header компонент
    - Реализовать отображение логотипа приложения
    - Реализовать навигационные ссылки
    - Реализовать меню пользователя
    - Реализовать гамбургер-меню для мобильных устройств
    - _Требования: 12.1, 12.4_
  
  - [ ] 13.2 Создать Navigation компонент
    - Реализовать навигационное меню (Dashboard, Транзакции, Категории, Бюджеты)
    - Реализовать подсветку активного пункта меню
    - Реализовать адаптивное отображение
    - _Требования: 15.1, 15.2, 15.3, 15.4, 15.5_
  
  - [ ]* 13.3 Написать property тест для подсветки активной страницы
    - **Свойство 20: Активная страница подсвечивается в навигации**
    - **Валидирует: Требования 15.5**
  
  - [ ] 13.4 Создать Footer компонент
    - Реализовать отображение копирайта
    - Реализовать отображение версии
    - Реализовать ссылки
    - _Требования: Общие_
  
  - [ ] 13.5 Создать корневой Layout
    - Интегрировать Header, Navigation, Footer
    - Настроить Next.js App Router layout
    - Обернуть приложение в AppProvider
    - _Требования: Все требования_


- [ ] 14. Реализация страниц и роутинга
  - [ ] 14.1 Создать страницу транзакций
    - Создать app/transactions/page.tsx
    - Интегрировать TransactionList, TransactionFilters
    - Реализовать модальное окно для создания/редактирования транзакций
    - Реализовать подтверждение удаления
    - Реализовать загрузку данных при монтировании
    - _Требования: 1.1, 1.2, 1.3, 1.5, 1.6, 1.7, 1.8_
  
  - [ ] 14.2 Создать страницу категорий
    - Создать app/categories/page.tsx
    - Интегрировать CategoryList
    - Реализовать модальное окно для создания/редактирования категорий
    - Реализовать подтверждение удаления с предупреждением о связанных транзакциях
    - Реализовать загрузку данных при монтировании
    - _Требования: 3.1, 3.2, 3.3, 3.6, 3.7_
  
  - [ ] 14.3 Создать страницу бюджетов
    - Создать app/budgets/page.tsx
    - Интегрировать BudgetList
    - Реализовать модальное окно для создания/редактирования бюджетов
    - Реализовать подтверждение удаления
    - Реализовать загрузку данных при монтировании
    - _Требования: 4.1, 4.2, 4.3_
  
  - [ ] 14.4 Настроить роутинг и навигацию
    - Настроить Next.js App Router
    - Реализовать поддержку кнопок браузера "Назад"/"Вперед"
    - Реализовать обработку прямого ввода URL
    - Создать страницу 404
    - _Требования: 15.1, 15.2, 15.3, 15.4, 15.6, 15.7, 15.8_

- [ ] 15. Реализация обработки ошибок и индикаторов загрузки
  - [ ] 15.1 Создать Error Handler компонент
    - Реализовать Toast уведомления для глобальных ошибок
    - Реализовать отображение специфичных для полей ошибок в формах
    - Реализовать кнопку "Повторить" для неудавших запросов
    - Реализовать понятные пользователю сообщения для различных типов ошибок
    - _Требования: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8_
  
  - [ ]* 15.2 Написать property тест для отображения ошибок API
    - **Свойство 10: Ошибки API отображают понятные пользователю сообщения**
    - **Валидирует: Требования 8.1**
  
  - [ ] 15.3 Создать Loading Indicator компоненты
    - Создать полноэкранный спиннер для начальной загрузки
    - Создать скелетоны для списков и карточек
    - Создать спиннер для кнопок
    - Создать inline спиннер для действий
    - _Требования: 9.1, 9.2, 9.3, 9.4, 9.5_
  
  - [ ]* 15.4 Написать property тест для индикаторов загрузки
    - **Свойство 11: Индикаторы загрузки появляются во время асинхронных операций**
    - **Валидирует: Требования 9.2**

- [ ] 16. Checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.


- [ ] 17. Оптимизация производительности
  - [ ] 17.1 Реализовать code splitting
    - Настроить динамический импорт для страниц
    - Настроить динамический импорт для тяжелых компонентов (графики)
    - Настроить Next.js code splitting
    - _Требования: 16.5_
  
  - [ ] 17.2 Реализовать ленивую загрузку
    - Реализовать ленивую загрузку изображений
    - Реализовать ленивую загрузку графиков
    - Реализовать предзагрузку данных для следующей страницы
    - _Требования: 16.4, 16.6_
  
  - [ ] 17.3 Реализовать оптимизацию вычислений
    - Добавить мемоизацию для дорогих вычислений (useMemo)
    - Добавить мемоизацию для callback функций (useCallback)
    - Реализовать debouncing для обновления графиков при изменении размера окна
    - _Требования: 16.7, 16.8_
  
  - [ ]* 17.4 Написать unit тесты производительности
    - Тестировать, что компоненты не перерисовываются без необходимости
    - Тестировать мемоизацию

- [ ] 18. Финальная интеграция и тестирование
  - [ ] 18.1 Интегрировать все компоненты
    - Убедиться, что все страницы корректно интегрированы
    - Убедиться, что навигация работает между всеми страницами
    - Убедиться, что состояние корректно управляется через Context
    - _Требования: Все требования_
  
  - [ ]* 18.2 Написать интеграционные тесты
    - Тестировать полные пользовательские потоки (создание транзакции, редактирование категории, удаление бюджета)
    - Тестировать навигацию между страницами
    - Тестировать сохранение состояния при навигации
    - _Требования: 14.6, 15.1, 15.2, 15.3, 15.4_
  
  - [ ] 18.3 Настроить CI/CD pipeline
    - Настроить pre-commit хуки (ESLint, TypeScript, тесты)
    - Настроить GitHub Actions для запуска всех тестов
    - Настроить генерацию отчета о покрытии
    - Настроить тесты доступности (axe-core)
    - _Требования: Все требования_
  
  - [ ] 18.4 Провести финальное тестирование
    - Запустить все unit тесты
    - Запустить все property тесты
    - Проверить покрытие кода (≥ 80%)
    - Проверить отсутствие ошибок TypeScript
    - Проверить отсутствие ошибок ESLint
    - Проверить размер бандла
    - _Требования: Все требования_

- [ ] 19. Финальный checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.

## Примечания

- Задачи, помеченные `*`, являются опциональными и могут быть пропущены для более быстрого MVP
- Каждая задача ссылается на конкретные требования для отслеживаемости
- Checkpoints обеспечивают инкрементальную валидацию
- Property тесты валидируют универсальные свойства корректности
- Unit тесты валидируют конкретные примеры и граничные случаи
- Все компоненты должны быть адаптивными и доступными
- Используется TypeScript для типобезопасности
- Используется Tailwind CSS для стилизации
- Используется Next.js 14+ App Router для роутинга
- Используется Context API для управления состоянием
- Используется React Hook Form для управления формами
- Используется Chart.js для визуализации данных
- Используется Axios для HTTP запросов
- Используется Jest и React Testing Library для unit тестов
- Используется fast-check для property-based тестов

