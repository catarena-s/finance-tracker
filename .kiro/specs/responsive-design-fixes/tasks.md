# План реализации: Исправление адаптивности дизайна

## Обзор

Данный план описывает пошаговую реализацию исправлений адаптивности дизайна приложения для управления финансами. Реализация будет выполнена на TypeScript с использованием React, Next.js и Tailwind CSS. План разбит на логические этапы с инкрементальной валидацией через тесты.

## Задачи

- [ ] 1. Создать утилиты и хуки для работы с брейкпоинтами
  - [x] 1.1 Создать хук useBreakpoint для определения текущего размера экрана
    - Реализовать интерфейс UseBreakpointReturn с флагами isMobile, isTablet, isDesktop
    - Использовать существующий хук useWindowSize
    - Добавить вычисление currentBreakpoint на основе ширины экрана
    - _Требования: 1.1, 2.1, 3.1, 5.1, 6.1, 7.1, 8.1_
  
  - [ ]* 1.2 Написать property-тест для хука useBreakpoint
    - **Свойство 1: Адаптивная раскладка компонентов**
    - **Валидирует: Требования 1.1, 3.1, 5.1, 8.1**
  
  - [x] 1.3 Создать конфигурационный файл ResponsiveConfig
    - Определить константы для брейкпоинтов, размеров touch targets, отступов
    - Экспортировать типизированную конфигурацию
    - _Требования: 2.4, 9.3_

- [ ] 2. Исправить адаптивность карточек баланса (BalanceCards)
  - [x] 2.1 Обновить компонент BalanceCards с адаптивными классами
    - Изменить grid на `grid-cols-1 md:grid-cols-3`
    - Добавить адаптивные отступы `p-4 sm:p-6 md:p-8`
    - Изменить размеры шрифтов на `text-2xl sm:text-3xl md:text-4xl`
    - Уменьшить размер иконок на мобильных `h-10 w-10 sm:h-12 sm:w-12`
    - _Требования: 1.1, 1.2, 1.4, 1.5_
  
  - [x] 2.2 Написать unit-тесты для BalanceCards
    - Тест отображения в одну колонку на мобильных (viewport 375px)
    - Тест отображения в три колонки на desktop (viewport 1024px)
    - Тест обработки пустых данных о валютах
    - _Требования: 1.1, 1.3_
  
  - [x] 2.3 Написать property-тест для адаптивных размеров шрифтов
    - **Свойство 2: Адаптивные размеры шрифтов**
    - **Валидирует: Требования 1.2, 6.1**
  
  - [x] 2.4 Написать property-тест для минимальных отступов
    - **Свойство 3: Минимальные отступы контейнеров**
    - **Валидирует: Требования 1.4, 6.3**
  
  - [x] 2.5 Написать property-тест для пропорций иконок
    - **Свойство 4: Сохранение пропорций иконок**
    - **Валидирует: Требования 1.5, 5.5**

- [ ] 3. Исправить адаптивность фильтров на дашборде
  - [x] 3.1 Обновить компонент страницы дашборда с адаптивными фильтрами
    - Изменить layout фильтров на `flex-col sm:flex-row`
    - Добавить минимальную ширину полей дат `min-w-[120px]`
    - Создать адаптивные метки для кнопок периодов (полные/сокращенные)
    - Увеличить область касания кнопок `min-h-[44px] min-w-[44px]`
    - _Требования: 2.1, 2.2, 2.3, 2.4, 2.5_
  
  - [x] 3.2 Написать property-тест для вертикального расположения фильтров
    - **Свойство 5: Вертикальное расположение фильтров**
    - **Валидирует: Требования 2.1, 6.2**
  
  - [x] 3.3 Написать property-тест для минимальных размеров интерактивных элементов
    - **Свойство 6: Минимальные размеры интерактивных элементов**
    - **Валидирует: Требования 2.4, 4.5, 5.4, 7.2, 9.3**
  
  - [x] 3.4 Написать property-тест для адаптивных меток кнопок
    - **Свойство 7: Адаптивные метки кнопок**
    - **Валидирует: Требования 2.5**

- [x] 4. Checkpoint - Проверка базовой адаптивности
  - Убедиться, что все тесты проходят
  - Проверить отображение дашборда на разных размерах экрана вручную
  - Спросить пользователя, если возникли вопросы

- [ ] 5. Исправить адаптивность графиков
  - [x] 5.1 Создать конфигурацию ChartResponsiveConfig
    - Определить адаптивные параметры для высоты, maxTicksLimit, pointRadius, fontSize
    - Экспортировать типизированную конфигурацию
    - _Требования: 3.2, 3.4_
  
  - [x] 5.2 Обновить компонент TrendChart с адаптивными настройками
    - Добавить динамическую высоту `h-64 sm:h-80 lg:h-96`
    - Использовать useBreakpoint для определения текущего размера
    - Применить адаптивный maxTicksLimit в опциях Chart.js
    - Уменьшить pointRadius на мобильных устройствах
    - _Требования: 3.1, 3.2, 3.3, 3.4, 3.5_
  
  - [x] 5.3 Обновить компонент TopCategoriesWidget с адаптивными настройками
    - Добавить динамическую высоту `h-64 sm:h-80 lg:h-96`
    - Применить адаптивные настройки Chart.js
    - _Требования: 3.1, 3.2, 3.3, 3.4_
  
  - [x] 5.4 Написать property-тест для минимальной высоты графиков
    - **Свойство 8: Минимальная высота графиков**
    - **Валидирует: Требования 3.2**
  
  - [x] 5.5 Написать property-тест для адаптивного количества меток
    - **Свойство 9: Адаптивное количество меток на осях**
    - **Валидирует: Требования 3.4**
  
  - [x] 5.6 Написать unit-тест для интерактивности графиков на сенсорных экранах
    - Проверить, что tooltip появляется при touch событиях
    - _Требования: 3.5_

- [ ] 6. Исправить адаптивность модальных окон
  - [x] 6.1 Обновить компонент Modal с адаптивными размерами
    - Изменить размеры на `w-[95%] sm:max-w-{size}`
    - Добавить прокрутку содержимого `overflow-y-auto max-h-[85vh]`
    - Увеличить кнопку закрытия до `h-11 w-11` (44x44px)
    - _Требования: 4.1, 4.2, 4.5_
  
  - [x] 6.2 Обновить формы в модальных окнах с вертикальным layout
    - Добавить адаптивные классы для полей формы `flex-col sm:flex-row`
    - Обеспечить вертикальное расположение на мобильных
    - _Требования: 4.3_
  
  - [x] 6.3 Написать property-тест для ширины модальных окон
    - **Свойство 10: Ширина модальных окон**
    - **Валидирует: Требования 4.1**
  
  - [x] 6.4 Написать property-тест для прокрутки модальных окон
    - **Свойство 11: Прокрутка содержимого модальных окон**
    - **Валидирует: Требования 4.2**
  
  - [x] 6.5 Написать property-тест для вертикального расположения полей формы
    - **Свойство 12: Вертикальное расположение полей формы**
    - **Валидирует: Требования 4.3**

- [ ] 7. Checkpoint - Проверка модальных окон и графиков
  - Убедиться, что все тесты проходят
  - Проверить работу модальных окон на мобильных устройствах
  - Спросить пользователя, если возникли вопросы

- [ ] 8. Исправить адаптивность карточек категорий
  - [x] 8.1 Обновить компонент CategoryCard с адаптивными классами
    - Изменить grid на `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3` (на уровне родителя)
    - Добавить обрезку текста `truncate` для названий
    - Увеличить кнопки действий на мобильных `h-9 w-9` (36x36px)
    - Сделать кнопки всегда видимыми на мобильных (убрать opacity-0)
    - _Требования: 5.1, 5.2, 5.3, 5.4, 5.5_
  
  - [-] 8.2 Написать property-тест для обрезки длинного текста
    - **Свойство 13: Обрезка длинного текста**
    - **Валидирует: Требования 5.2, 8.3**
  
  - [x] 8.3 Написать unit-тест для отображения кнопок действий
    - Проверить, что кнопки появляются при hover на desktop
    - Проверить, что кнопки всегда видимы на мобильных
    - _Требования: 5.3_

- [ ] 9. Исправить адаптивность заголовков страниц
  - [x] 9.1 Обновить заголовки на всех страницах с адаптивными классами
    - Изменить размер шрифта на `text-2xl md:text-3xl`
    - Добавить вертикальное расположение элементов на мобильных `flex-col sm:flex-row`
    - Обеспечить минимальные отступы `px-4 sm:px-6 lg:px-8`
    - _Требования: 6.1, 6.2, 6.3, 6.5_
  
  - [x] 9.2 Написать unit-тесты для заголовков
    - Тест размера шрифта на мобильных и desktop
    - Тест минимальных отступов
    - _Требования: 6.1, 6.3_

- [ ] 10. Создать адаптивный список транзакций
  - [x] 10.1 Создать компонент TransactionCard для мобильного представления
    - Реализовать карточное представление с всеми ключевыми данными
    - Добавить обрезку описаний `line-clamp-2`
    - Добавить обработчик клика для отображения полной информации
    - _Требования: 8.1, 8.2, 8.3, 8.4, 8.5_
  
  - [x] 10.2 Обновить компонент TransactionList с условным рендерингом
    - Использовать useBreakpoint для определения типа отображения
    - Рендерить таблицу на desktop, карточки на mobile
    - _Требования: 8.1_
  
  - [ ] 10.3 Написать property-тест для отображения ключевых данных в карточках
    - **Свойство 14: Отображение всех ключевых данных в карточках**
    - **Валидирует: Требования 8.2**
  
  - [x] 10.4 Написать unit-тест для интерактивности карточек транзакций
    - Проверить, что при клике отображается полная информация
    - _Требования: 8.4_

- [ ] 11. Checkpoint - Проверка всех компонентов
  - Убедиться, что все тесты проходят
  - Проверить все страницы на разных размерах экрана
  - Спросить пользователя, если возникли вопросы

- [ ] 12. Добавить глобальные стили и оптимизации
  - [x] 12.1 Обновить globals.css с адаптивными стилями
    - Добавить `overflow-x: hidden` на body для предотвращения горизонтальной прокрутки
    - Добавить CSS-переменные для адаптивных отступов
    - Добавить @supports fallback для старых браузеров
    - _Требования: 9.2, 10.3_
  
  - [-] 12.2 Оптимизировать анимации для производительности
    - Проверить, что все анимации используют transform и opacity
    - Добавить will-change для критических анимаций
    - _Требования: 10.3_
  
  - [ ] 12.3 Написать property-тест для отсутствия горизонтальной прокрутки
    - **Свойство 15: Отсутствие горизонтальной прокрутки**
    - **Валидирует: Требования 9.2**
  
  - [ ] 12.4 Написать property-тест для использования CSS-трансформаций
    - **Свойство 17: Использование CSS-трансформаций для анимаций**
    - **Валидирует: Требования 10.3**

- [ ] 13. Оптимизировать графики для мобильных устройств
  - [x] 13.1 Добавить оптимизацию точек данных для графиков
    - Создать функцию для sampling/агрегации данных на мобильных
    - Применить оптимизацию в TrendChart и TopCategoriesWidget
    - _Требования: 10.2_
  
  - [ ] 13.2 Написать property-тест для оптимизации точек данных
    - **Свойство 16: Оптимизация точек данных графиков**
    - **Валидирует: Требования 10.2**

- [ ] 14. Создать визуальные регрессионные тесты
  - [ ] 14.1 Настроить Playwright для визуального тестирования
    - Создать конфигурацию для снимков на разных брейкпоинтах
    - Добавить тесты для дашборда, модальных окон, списка транзакций
    - _Требования: 9.1, 9.4_
  
  - [ ] 14.2 Написать E2E тесты для всех ключевых страниц
    - Тесты дашборда на 320px, 375px, 768px, 1024px, 1440px
    - Тесты модальных окон на мобильных и desktop
    - Тесты списка транзакций в обоих режимах
    - _Требования: 9.1_

- [ ] 15. Добавить тесты доступности
  - [ ] 15.1 Написать тесты с jest-axe для проверки доступности
    - Проверить минимальные размеры touch targets
    - Проверить контрастность текста
    - Проверить keyboard navigation
    - _Требования: 2.4, 9.3_

- [ ] 16. Документировать изменения
  - [x] 16.1 Обновить README.md с руководством по адаптивному дизайну
    - Описать систему брейкпоинтов
    - Добавить примеры использования адаптивных классов
    - Документировать правила для новых компонентов
    - _Требования: 9.5_
  
  - [x] 16.2 Добавить комментарии в код компонентов
    - Документировать все адаптивные классы
    - Объяснить логику выбора брейкпоинтов
    - _Требования: 9.5_

- [ ] 17. Финальный checkpoint - Полная проверка
  - Убедиться, что все тесты проходят (unit, property, E2E)
  - Проверить производительность на мобильных устройствах
  - Проверить доступность с помощью screen reader
  - Спросить пользователя о готовности к деплою

## Примечания

- Задачи, отмеченные `*`, являются опциональными и могут быть пропущены для более быстрого MVP
- Каждая задача ссылается на конкретные требования для отслеживаемости
- Checkpoints обеспечивают инкрементальную валидацию
- Property-тесты валидируют универсальные свойства корректности
- Unit-тесты валидируют конкретные примеры и edge cases
