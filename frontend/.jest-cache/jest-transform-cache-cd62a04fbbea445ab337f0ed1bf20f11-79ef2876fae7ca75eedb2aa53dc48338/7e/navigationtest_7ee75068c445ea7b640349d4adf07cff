0577f754ee29a09f5ebca80f0e0c1530
/**
 * Integration Tests - Navigation and State Persistence
 * 
 * Tests navigation between pages and state persistence:
 * - State preservation during operations
 * - Optimistic updates and rollback
 * - Error handling and recovery
 * 
 * Requirements: 14.6, 15.1, 15.2, 15.3, 15.4
 */ "use strict";
// Mock the API modules
jest.mock("@/services/api/transactions");
jest.mock("@/services/api/categories");
jest.mock("@/services/api/budgets");
jest.mock("@/services/api/analytics");
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_default(require("react"));
const _react1 = require("@testing-library/react");
const _userevent = /*#__PURE__*/ _interop_require_default(require("@testing-library/user-event"));
const _AppContext = require("../../src/contexts/AppContext");
const _transactions = require("../../src/services/api/transactions");
const _categories = require("../../src/services/api/categories");
const _budgets = require("../../src/services/api/budgets");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const mockTransactionApi = _transactions.transactionApi;
const mockCategoryApi = _categories.categoryApi;
const mockBudgetApi = _budgets.budgetApi;
describe("Integration Tests - Navigation and State Persistence", ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
    });
    describe("State Persistence", ()=>{
        it("should maintain filter state during pagination", async ()=>{
            const mockTransactions = Array.from({
                length: 25
            }, (_, i)=>({
                    id: `txn-${i}`,
                    type: i % 2 === 0 ? "expense" : "income",
                    amount: 50.00 + i,
                    currency: "USD",
                    categoryId: "cat-1",
                    description: `Transaction ${i}`,
                    transactionDate: "2024-01-15",
                    isRecurring: false,
                    createdAt: "2024-01-15T00:00:00Z",
                    updatedAt: "2024-01-15T00:00:00Z",
                    category: {
                        id: "cat-1",
                        name: "Food",
                        color: "#FF5733"
                    }
                }));
            mockTransactionApi.getAll.mockResolvedValue({
                data: mockTransactions,
                pagination: {
                    page: 1,
                    pageSize: 10,
                    totalPages: 3,
                    totalItems: 25
                }
            });
            function TestApp() {
                const { loadTransactions, transactions } = (0, _AppContext.useApp)();
                const [filters, setFilters] = _react.default.useState({
                    type: "expense"
                });
                const [page, setPage] = _react.default.useState(1);
                _react.default.useEffect(()=>{
                    loadTransactions({
                        ...filters,
                        page,
                        pageSize: 10
                    });
                }, [
                    filters,
                    page
                ]);
                return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                    children: [
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "transactions-count",
                            children: transactions.length
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "current-page",
                            children: page
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "current-filter",
                            children: filters.type
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: ()=>setPage(2),
                            children: "Next Page"
                        })
                    ]
                });
            }
            const user = _userevent.default.setup();
            (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_AppContext.AppProvider, {
                children: /*#__PURE__*/ (0, _jsxruntime.jsx)(TestApp, {})
            }));
            // Wait for initial load
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("transactions-count")).toHaveTextContent("25");
            });
            // Verify initial state
            expect(_react1.screen.getByTestId("current-page")).toHaveTextContent("1");
            expect(_react1.screen.getByTestId("current-filter")).toHaveTextContent("expense");
            // Navigate to next page
            await user.click(_react1.screen.getByText("Next Page"));
            // Verify filter is maintained
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("current-page")).toHaveTextContent("2");
                expect(_react1.screen.getByTestId("current-filter")).toHaveTextContent("expense");
            });
            // Verify API was called with filters
            expect(mockTransactionApi.getAll).toHaveBeenLastCalledWith(expect.objectContaining({
                type: "expense",
                page: 2,
                pageSize: 10
            }));
        });
    });
    describe("Optimistic Updates and Rollback", ()=>{
        it("should apply optimistic updates immediately", async ()=>{
            const mockTransaction = {
                id: "txn-1",
                type: "expense",
                amount: 50.00,
                currency: "USD",
                categoryId: "cat-1",
                description: "Test",
                transactionDate: "2024-01-15",
                isRecurring: false,
                createdAt: "2024-01-15T00:00:00Z",
                updatedAt: "2024-01-15T00:00:00Z"
            };
            mockTransactionApi.create.mockResolvedValue(mockTransaction);
            function TestApp() {
                const { createTransaction, transactions } = (0, _AppContext.useApp)();
                return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                    children: [
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "transactions-count",
                            children: transactions.length
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: ()=>createTransaction({
                                    type: "expense",
                                    amount: 50.00,
                                    currency: "USD",
                                    categoryId: "cat-1",
                                    description: "Test",
                                    transactionDate: "2024-01-15",
                                    isRecurring: false
                                }),
                            children: "Create Transaction"
                        })
                    ]
                });
            }
            const user = _userevent.default.setup();
            (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_AppContext.AppProvider, {
                children: /*#__PURE__*/ (0, _jsxruntime.jsx)(TestApp, {})
            }));
            // Initial state
            expect(_react1.screen.getByTestId("transactions-count")).toHaveTextContent("0");
            // Create transaction
            await user.click(_react1.screen.getByText("Create Transaction"));
            // Verify optimistic update
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("transactions-count")).toHaveTextContent("1");
            });
        });
        it("should rollback on failure", async ()=>{
            const mockTransaction = {
                id: "txn-1",
                type: "expense",
                amount: 50.00,
                currency: "USD",
                categoryId: "cat-1",
                description: "Test",
                transactionDate: "2024-01-15",
                isRecurring: false,
                createdAt: "2024-01-15T00:00:00Z",
                updatedAt: "2024-01-15T00:00:00Z",
                category: {
                    id: "cat-1",
                    name: "Food",
                    color: "#FF5733"
                }
            };
            mockTransactionApi.getAll.mockResolvedValue({
                data: [
                    mockTransaction
                ],
                pagination: {
                    page: 1,
                    pageSize: 10,
                    totalPages: 1,
                    totalItems: 1
                }
            });
            mockTransactionApi.delete.mockRejectedValue(new Error("Delete failed"));
            function TestApp() {
                const { loadTransactions, deleteTransaction, transactions, error } = (0, _AppContext.useApp)();
                _react.default.useEffect(()=>{
                    loadTransactions();
                }, []);
                return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                    children: [
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "transactions-count",
                            children: transactions.length
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "error",
                            children: error || "none"
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: ()=>deleteTransaction("txn-1").catch(()=>{}),
                            children: "Delete Transaction"
                        })
                    ]
                });
            }
            const user = _userevent.default.setup();
            (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_AppContext.AppProvider, {
                children: /*#__PURE__*/ (0, _jsxruntime.jsx)(TestApp, {})
            }));
            // Wait for initial load
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("transactions-count")).toHaveTextContent("1");
            });
            // Attempt to delete
            await user.click(_react1.screen.getByText("Delete Transaction"));
            // Verify rollback after failure
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("transactions-count")).toHaveTextContent("1");
                expect(_react1.screen.getByTestId("error")).toHaveTextContent("Delete failed");
            });
        });
    });
    describe("Error Handling and Recovery", ()=>{
        it("should display error messages and allow retry", async ()=>{
            mockTransactionApi.getAll.mockRejectedValueOnce(new Error("Network error")).mockResolvedValueOnce({
                data: [],
                pagination: {
                    page: 1,
                    pageSize: 10,
                    totalPages: 0,
                    totalItems: 0
                }
            });
            function TestApp() {
                const { loadTransactions, error, clearError } = (0, _AppContext.useApp)();
                return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                    children: [
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "error",
                            children: error || "none"
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: ()=>loadTransactions().catch(()=>{}),
                            children: "Load Transactions"
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: clearError,
                            children: "Clear Error"
                        })
                    ]
                });
            }
            const user = _userevent.default.setup();
            (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_AppContext.AppProvider, {
                children: /*#__PURE__*/ (0, _jsxruntime.jsx)(TestApp, {})
            }));
            // Trigger error
            await user.click(_react1.screen.getByText("Load Transactions"));
            // Verify error is displayed
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("error")).toHaveTextContent("Network error");
            });
            // Clear error
            await user.click(_react1.screen.getByText("Clear Error"));
            // Verify error is cleared
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("error")).toHaveTextContent("none");
            });
            // Retry and succeed
            await user.click(_react1.screen.getByText("Load Transactions"));
            // Verify success
            await (0, _react1.waitFor)(()=>{
                expect(_react1.screen.getByTestId("error")).toHaveTextContent("none");
            });
        });
    });
    describe("Concurrent Operations", ()=>{
        it("should handle multiple simultaneous operations correctly", async ()=>{
            const mockCategories = [
                {
                    id: "cat-1",
                    name: "Food",
                    type: "expense",
                    color: "#FF5733",
                    createdAt: "2024-01-01T00:00:00Z",
                    updatedAt: "2024-01-01T00:00:00Z"
                }
            ];
            mockCategoryApi.getAll.mockResolvedValue(mockCategories);
            mockTransactionApi.getAll.mockResolvedValue({
                data: [],
                pagination: {
                    page: 1,
                    pageSize: 10,
                    totalPages: 0,
                    totalItems: 0
                }
            });
            mockBudgetApi.getAll.mockResolvedValue([]);
            function TestApp() {
                const { loadTransactions, loadCategories, loadBudgets, loading } = (0, _AppContext.useApp)();
                const [loaded, setLoaded] = _react.default.useState(false);
                const loadAll = async ()=>{
                    await Promise.all([
                        loadTransactions(),
                        loadCategories(),
                        loadBudgets()
                    ]);
                    setLoaded(true);
                };
                return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                    children: [
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "loading",
                            children: loading ? "loading" : "idle"
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                            "data-testid": "loaded",
                            children: loaded ? "yes" : "no"
                        }),
                        /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                            onClick: loadAll,
                            children: "Load All"
                        })
                    ]
                });
            }
            const user = _userevent.default.setup();
            (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_AppContext.AppProvider, {
                children: /*#__PURE__*/ (0, _jsxruntime.jsx)(TestApp, {})
            }));
            // Trigger multiple loads
            await user.click(_react1.screen.getByText("Load All"));
            // Verify all APIs were called
            await (0, _react1.waitFor)(()=>{
                expect(mockTransactionApi.getAll).toHaveBeenCalled();
                expect(mockCategoryApi.getAll).toHaveBeenCalled();
                expect(mockBudgetApi.getAll).toHaveBeenCalled();
                expect(_react1.screen.getByTestId("loaded")).toHaveTextContent("yes");
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkU6XFxteVxcb3R1c1xcZmluYW5jZV90cmFja2VyXFxmcm9udGVuZFxcX190ZXN0c19fXFxpbnRlZ3JhdGlvblxcbmF2aWdhdGlvbi50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogSW50ZWdyYXRpb24gVGVzdHMgLSBOYXZpZ2F0aW9uIGFuZCBTdGF0ZSBQZXJzaXN0ZW5jZVxyXG4gKiBcclxuICogVGVzdHMgbmF2aWdhdGlvbiBiZXR3ZWVuIHBhZ2VzIGFuZCBzdGF0ZSBwZXJzaXN0ZW5jZTpcclxuICogLSBTdGF0ZSBwcmVzZXJ2YXRpb24gZHVyaW5nIG9wZXJhdGlvbnNcclxuICogLSBPcHRpbWlzdGljIHVwZGF0ZXMgYW5kIHJvbGxiYWNrXHJcbiAqIC0gRXJyb3IgaGFuZGxpbmcgYW5kIHJlY292ZXJ5XHJcbiAqIFxyXG4gKiBSZXF1aXJlbWVudHM6IDE0LjYsIDE1LjEsIDE1LjIsIDE1LjMsIDE1LjRcclxuICovXHJcblxyXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgd2FpdEZvciB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xyXG5pbXBvcnQgdXNlckV2ZW50IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvdXNlci1ldmVudCc7XHJcbmltcG9ydCB7IEFwcFByb3ZpZGVyLCB1c2VBcHAgfSBmcm9tICdAL2NvbnRleHRzL0FwcENvbnRleHQnO1xyXG5pbXBvcnQgeyB0cmFuc2FjdGlvbkFwaSB9IGZyb20gJ0Avc2VydmljZXMvYXBpL3RyYW5zYWN0aW9ucyc7XHJcbmltcG9ydCB7IGNhdGVnb3J5QXBpIH0gZnJvbSAnQC9zZXJ2aWNlcy9hcGkvY2F0ZWdvcmllcyc7XHJcbmltcG9ydCB7IGJ1ZGdldEFwaSB9IGZyb20gJ0Avc2VydmljZXMvYXBpL2J1ZGdldHMnO1xyXG5cclxuLy8gTW9jayB0aGUgQVBJIG1vZHVsZXNcclxuamVzdC5tb2NrKCdAL3NlcnZpY2VzL2FwaS90cmFuc2FjdGlvbnMnKTtcclxuamVzdC5tb2NrKCdAL3NlcnZpY2VzL2FwaS9jYXRlZ29yaWVzJyk7XHJcbmplc3QubW9jaygnQC9zZXJ2aWNlcy9hcGkvYnVkZ2V0cycpO1xyXG5qZXN0Lm1vY2soJ0Avc2VydmljZXMvYXBpL2FuYWx5dGljcycpO1xyXG5cclxuY29uc3QgbW9ja1RyYW5zYWN0aW9uQXBpID0gdHJhbnNhY3Rpb25BcGkgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIHRyYW5zYWN0aW9uQXBpPjtcclxuY29uc3QgbW9ja0NhdGVnb3J5QXBpID0gY2F0ZWdvcnlBcGkgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGNhdGVnb3J5QXBpPjtcclxuY29uc3QgbW9ja0J1ZGdldEFwaSA9IGJ1ZGdldEFwaSBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgYnVkZ2V0QXBpPjtcclxuXHJcbmRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cyAtIE5hdmlnYXRpb24gYW5kIFN0YXRlIFBlcnNpc3RlbmNlJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTdGF0ZSBQZXJzaXN0ZW5jZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gZmlsdGVyIHN0YXRlIGR1cmluZyBwYWdpbmF0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb25zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMjUgfSwgKF8sIGkpID0+ICh7XHJcbiAgICAgICAgaWQ6IGB0eG4tJHtpfWAsXHJcbiAgICAgICAgdHlwZTogaSAlIDIgPT09IDAgPyAoJ2V4cGVuc2UnIGFzIGNvbnN0KSA6ICgnaW5jb21lJyBhcyBjb25zdCksXHJcbiAgICAgICAgYW1vdW50OiA1MC4wMCArIGksXHJcbiAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxyXG4gICAgICAgIGNhdGVnb3J5SWQ6ICdjYXQtMScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGBUcmFuc2FjdGlvbiAke2l9YCxcclxuICAgICAgICB0cmFuc2FjdGlvbkRhdGU6ICcyMDI0LTAxLTE1JyxcclxuICAgICAgICBpc1JlY3VycmluZzogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0xNVQwMDowMDowMFonLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogJzIwMjQtMDEtMTVUMDA6MDA6MDBaJyxcclxuICAgICAgICBjYXRlZ29yeToge1xyXG4gICAgICAgICAgaWQ6ICdjYXQtMScsXHJcbiAgICAgICAgICBuYW1lOiAnRm9vZCcsXHJcbiAgICAgICAgICBjb2xvcjogJyNGRjU3MzMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tUcmFuc2FjdGlvbkFwaS5nZXRBbGwubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG1vY2tUcmFuc2FjdGlvbnMsXHJcbiAgICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgIHBhZ2VTaXplOiAxMCxcclxuICAgICAgICAgIHRvdGFsUGFnZXM6IDMsXHJcbiAgICAgICAgICB0b3RhbEl0ZW1zOiAyNSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIFRlc3RBcHAoKSB7XHJcbiAgICAgICAgY29uc3QgeyBsb2FkVHJhbnNhY3Rpb25zLCB0cmFuc2FjdGlvbnMgfSA9IHVzZUFwcCgpO1xyXG4gICAgICAgIGNvbnN0IFtmaWx0ZXJzLCBzZXRGaWx0ZXJzXSA9IFJlYWN0LnVzZVN0YXRlKHsgdHlwZTogJ2V4cGVuc2UnIGFzIGNvbnN0IH0pO1xyXG4gICAgICAgIGNvbnN0IFtwYWdlLCBzZXRQYWdlXSA9IFJlYWN0LnVzZVN0YXRlKDEpO1xyXG5cclxuICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgICAgICAgbG9hZFRyYW5zYWN0aW9ucyh7IC4uLmZpbHRlcnMsIHBhZ2UsIHBhZ2VTaXplOiAxMCB9KTtcclxuICAgICAgICB9LCBbZmlsdGVycywgcGFnZV0pO1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cInRyYW5zYWN0aW9ucy1jb3VudFwiPnt0cmFuc2FjdGlvbnMubGVuZ3RofTwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwiY3VycmVudC1wYWdlXCI+e3BhZ2V9PC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJjdXJyZW50LWZpbHRlclwiPntmaWx0ZXJzLnR5cGV9PC9kaXY+XHJcbiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0UGFnZSgyKX0+TmV4dCBQYWdlPC9idXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKCk7XHJcblxyXG4gICAgICByZW5kZXIoXHJcbiAgICAgICAgPEFwcFByb3ZpZGVyPlxyXG4gICAgICAgICAgPFRlc3RBcHAgLz5cclxuICAgICAgICA8L0FwcFByb3ZpZGVyPlxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gV2FpdCBmb3IgaW5pdGlhbCBsb2FkXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3RyYW5zYWN0aW9ucy1jb3VudCcpKS50b0hhdmVUZXh0Q29udGVudCgnMjUnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBWZXJpZnkgaW5pdGlhbCBzdGF0ZVxyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdjdXJyZW50LXBhZ2UnKSkudG9IYXZlVGV4dENvbnRlbnQoJzEnKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnY3VycmVudC1maWx0ZXInKSkudG9IYXZlVGV4dENvbnRlbnQoJ2V4cGVuc2UnKTtcclxuXHJcbiAgICAgIC8vIE5hdmlnYXRlIHRvIG5leHQgcGFnZVxyXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHNjcmVlbi5nZXRCeVRleHQoJ05leHQgUGFnZScpKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmeSBmaWx0ZXIgaXMgbWFpbnRhaW5lZFxyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdjdXJyZW50LXBhZ2UnKSkudG9IYXZlVGV4dENvbnRlbnQoJzInKTtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdjdXJyZW50LWZpbHRlcicpKS50b0hhdmVUZXh0Q29udGVudCgnZXhwZW5zZScpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFZlcmlmeSBBUEkgd2FzIGNhbGxlZCB3aXRoIGZpbHRlcnNcclxuICAgICAgZXhwZWN0KG1vY2tUcmFuc2FjdGlvbkFwaS5nZXRBbGwpLnRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICB0eXBlOiAnZXhwZW5zZScsXHJcbiAgICAgICAgICBwYWdlOiAyLFxyXG4gICAgICAgICAgcGFnZVNpemU6IDEwLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ09wdGltaXN0aWMgVXBkYXRlcyBhbmQgUm9sbGJhY2snLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGFwcGx5IG9wdGltaXN0aWMgdXBkYXRlcyBpbW1lZGlhdGVseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xyXG4gICAgICAgIGlkOiAndHhuLTEnLFxyXG4gICAgICAgIHR5cGU6ICdleHBlbnNlJyBhcyBjb25zdCxcclxuICAgICAgICBhbW91bnQ6IDUwLjAwLFxyXG4gICAgICAgIGN1cnJlbmN5OiAnVVNEJyxcclxuICAgICAgICBjYXRlZ29yeUlkOiAnY2F0LTEnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCcsXHJcbiAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiAnMjAyNC0wMS0xNScsXHJcbiAgICAgICAgaXNSZWN1cnJpbmc6IGZhbHNlLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogJzIwMjQtMDEtMTVUMDA6MDA6MDBaJyxcclxuICAgICAgICB1cGRhdGVkQXQ6ICcyMDI0LTAxLTE1VDAwOjAwOjAwWicsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrVHJhbnNhY3Rpb25BcGkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUcmFuc2FjdGlvbik7XHJcblxyXG4gICAgICBmdW5jdGlvbiBUZXN0QXBwKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY3JlYXRlVHJhbnNhY3Rpb24sIHRyYW5zYWN0aW9ucyB9ID0gdXNlQXBwKCk7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwidHJhbnNhY3Rpb25zLWNvdW50XCI+e3RyYW5zYWN0aW9ucy5sZW5ndGh9PC9kaXY+XHJcbiAgICAgICAgICAgIDxidXR0b25cclxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PlxyXG4gICAgICAgICAgICAgICAgY3JlYXRlVHJhbnNhY3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICB0eXBlOiAnZXhwZW5zZScsXHJcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogNTAuMDAsXHJcbiAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnVVNEJyxcclxuICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlJZDogJ2NhdC0xJyxcclxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0JyxcclxuICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiAnMjAyNC0wMS0xNScsXHJcbiAgICAgICAgICAgICAgICAgIGlzUmVjdXJyaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgQ3JlYXRlIFRyYW5zYWN0aW9uXHJcbiAgICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xyXG5cclxuICAgICAgcmVuZGVyKFxyXG4gICAgICAgIDxBcHBQcm92aWRlcj5cclxuICAgICAgICAgIDxUZXN0QXBwIC8+XHJcbiAgICAgICAgPC9BcHBQcm92aWRlcj5cclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIEluaXRpYWwgc3RhdGVcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgndHJhbnNhY3Rpb25zLWNvdW50JykpLnRvSGF2ZVRleHRDb250ZW50KCcwJyk7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgdHJhbnNhY3Rpb25cclxuICAgICAgYXdhaXQgdXNlci5jbGljayhzY3JlZW4uZ2V0QnlUZXh0KCdDcmVhdGUgVHJhbnNhY3Rpb24nKSk7XHJcblxyXG4gICAgICAvLyBWZXJpZnkgb3B0aW1pc3RpYyB1cGRhdGVcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgndHJhbnNhY3Rpb25zLWNvdW50JykpLnRvSGF2ZVRleHRDb250ZW50KCcxJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByb2xsYmFjayBvbiBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XHJcbiAgICAgICAgaWQ6ICd0eG4tMScsXHJcbiAgICAgICAgdHlwZTogJ2V4cGVuc2UnIGFzIGNvbnN0LFxyXG4gICAgICAgIGFtb3VudDogNTAuMDAsXHJcbiAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxyXG4gICAgICAgIGNhdGVnb3J5SWQ6ICdjYXQtMScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0JyxcclxuICAgICAgICB0cmFuc2FjdGlvbkRhdGU6ICcyMDI0LTAxLTE1JyxcclxuICAgICAgICBpc1JlY3VycmluZzogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0xNVQwMDowMDowMFonLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogJzIwMjQtMDEtMTVUMDA6MDA6MDBaJyxcclxuICAgICAgICBjYXRlZ29yeToge1xyXG4gICAgICAgICAgaWQ6ICdjYXQtMScsXHJcbiAgICAgICAgICBuYW1lOiAnRm9vZCcsXHJcbiAgICAgICAgICBjb2xvcjogJyNGRjU3MzMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrVHJhbnNhY3Rpb25BcGkuZ2V0QWxsLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBbbW9ja1RyYW5zYWN0aW9uXSxcclxuICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgcGFnZVNpemU6IDEwLFxyXG4gICAgICAgICAgdG90YWxQYWdlczogMSxcclxuICAgICAgICAgIHRvdGFsSXRlbXM6IDEsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIG1vY2tUcmFuc2FjdGlvbkFwaS5kZWxldGUubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEZWxldGUgZmFpbGVkJykpO1xyXG5cclxuICAgICAgZnVuY3Rpb24gVGVzdEFwcCgpIHtcclxuICAgICAgICBjb25zdCB7IGxvYWRUcmFuc2FjdGlvbnMsIGRlbGV0ZVRyYW5zYWN0aW9uLCB0cmFuc2FjdGlvbnMsIGVycm9yIH0gPSB1c2VBcHAoKTtcclxuXHJcbiAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICAgIGxvYWRUcmFuc2FjdGlvbnMoKTtcclxuICAgICAgICB9LCBbXSk7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwidHJhbnNhY3Rpb25zLWNvdW50XCI+e3RyYW5zYWN0aW9ucy5sZW5ndGh9PC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJlcnJvclwiPntlcnJvciB8fCAnbm9uZSd9PC9kaXY+XHJcbiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gZGVsZXRlVHJhbnNhY3Rpb24oJ3R4bi0xJykuY2F0Y2goKCkgPT4ge30pfT5cclxuICAgICAgICAgICAgICBEZWxldGUgVHJhbnNhY3Rpb25cclxuICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKCk7XHJcblxyXG4gICAgICByZW5kZXIoXHJcbiAgICAgICAgPEFwcFByb3ZpZGVyPlxyXG4gICAgICAgICAgPFRlc3RBcHAgLz5cclxuICAgICAgICA8L0FwcFByb3ZpZGVyPlxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gV2FpdCBmb3IgaW5pdGlhbCBsb2FkXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3RyYW5zYWN0aW9ucy1jb3VudCcpKS50b0hhdmVUZXh0Q29udGVudCgnMScpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEF0dGVtcHQgdG8gZGVsZXRlXHJcbiAgICAgIGF3YWl0IHVzZXIuY2xpY2soc2NyZWVuLmdldEJ5VGV4dCgnRGVsZXRlIFRyYW5zYWN0aW9uJykpO1xyXG5cclxuICAgICAgLy8gVmVyaWZ5IHJvbGxiYWNrIGFmdGVyIGZhaWx1cmVcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgndHJhbnNhY3Rpb25zLWNvdW50JykpLnRvSGF2ZVRleHRDb250ZW50KCcxJyk7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnZXJyb3InKSkudG9IYXZlVGV4dENvbnRlbnQoJ0RlbGV0ZSBmYWlsZWQnKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nIGFuZCBSZWNvdmVyeScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGlzcGxheSBlcnJvciBtZXNzYWdlcyBhbmQgYWxsb3cgcmV0cnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tUcmFuc2FjdGlvbkFwaS5nZXRBbGxcclxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiAxMCxcclxuICAgICAgICAgICAgdG90YWxQYWdlczogMCxcclxuICAgICAgICAgICAgdG90YWxJdGVtczogMCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBmdW5jdGlvbiBUZXN0QXBwKCkge1xyXG4gICAgICAgIGNvbnN0IHsgbG9hZFRyYW5zYWN0aW9ucywgZXJyb3IsIGNsZWFyRXJyb3IgfSA9IHVzZUFwcCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImVycm9yXCI+e2Vycm9yIHx8ICdub25lJ308L2Rpdj5cclxuICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBsb2FkVHJhbnNhY3Rpb25zKCkuY2F0Y2goKCkgPT4ge30pfT5cclxuICAgICAgICAgICAgICBMb2FkIFRyYW5zYWN0aW9uc1xyXG4gICAgICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtjbGVhckVycm9yfT5DbGVhciBFcnJvcjwvYnV0dG9uPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xyXG5cclxuICAgICAgcmVuZGVyKFxyXG4gICAgICAgIDxBcHBQcm92aWRlcj5cclxuICAgICAgICAgIDxUZXN0QXBwIC8+XHJcbiAgICAgICAgPC9BcHBQcm92aWRlcj5cclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIFRyaWdnZXIgZXJyb3JcclxuICAgICAgYXdhaXQgdXNlci5jbGljayhzY3JlZW4uZ2V0QnlUZXh0KCdMb2FkIFRyYW5zYWN0aW9ucycpKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmeSBlcnJvciBpcyBkaXNwbGF5ZWRcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnZXJyb3InKSkudG9IYXZlVGV4dENvbnRlbnQoJ05ldHdvcmsgZXJyb3InKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBDbGVhciBlcnJvclxyXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHNjcmVlbi5nZXRCeVRleHQoJ0NsZWFyIEVycm9yJykpO1xyXG5cclxuICAgICAgLy8gVmVyaWZ5IGVycm9yIGlzIGNsZWFyZWRcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnZXJyb3InKSkudG9IYXZlVGV4dENvbnRlbnQoJ25vbmUnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBSZXRyeSBhbmQgc3VjY2VlZFxyXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHNjcmVlbi5nZXRCeVRleHQoJ0xvYWQgVHJhbnNhY3Rpb25zJykpO1xyXG5cclxuICAgICAgLy8gVmVyaWZ5IHN1Y2Nlc3NcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnZXJyb3InKSkudG9IYXZlVGV4dENvbnRlbnQoJ25vbmUnKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NvbmN1cnJlbnQgT3BlcmF0aW9ucycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIHNpbXVsdGFuZW91cyBvcGVyYXRpb25zIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0NhdGVnb3JpZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdjYXQtMScsXHJcbiAgICAgICAgICBuYW1lOiAnRm9vZCcsXHJcbiAgICAgICAgICB0eXBlOiAnZXhwZW5zZScgYXMgY29uc3QsXHJcbiAgICAgICAgICBjb2xvcjogJyNGRjU3MzMnLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ2F0ZWdvcnlBcGkuZ2V0QWxsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDYXRlZ29yaWVzKTtcclxuICAgICAgbW9ja1RyYW5zYWN0aW9uQXBpLmdldEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgIHBhZ2VTaXplOiAxMCxcclxuICAgICAgICAgIHRvdGFsUGFnZXM6IDAsXHJcbiAgICAgICAgICB0b3RhbEl0ZW1zOiAwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBtb2NrQnVkZ2V0QXBpLmdldEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XHJcblxyXG4gICAgICBmdW5jdGlvbiBUZXN0QXBwKCkge1xyXG4gICAgICAgIGNvbnN0IHsgbG9hZFRyYW5zYWN0aW9ucywgbG9hZENhdGVnb3JpZXMsIGxvYWRCdWRnZXRzLCBsb2FkaW5nIH0gPSB1c2VBcHAoKTtcclxuICAgICAgICBjb25zdCBbbG9hZGVkLCBzZXRMb2FkZWRdID0gUmVhY3QudXNlU3RhdGUoZmFsc2UpO1xyXG5cclxuICAgICAgICBjb25zdCBsb2FkQWxsID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICBsb2FkVHJhbnNhY3Rpb25zKCksXHJcbiAgICAgICAgICAgIGxvYWRDYXRlZ29yaWVzKCksXHJcbiAgICAgICAgICAgIGxvYWRCdWRnZXRzKCksXHJcbiAgICAgICAgICBdKTtcclxuICAgICAgICAgIHNldExvYWRlZCh0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImxvYWRpbmdcIj57bG9hZGluZyA/ICdsb2FkaW5nJyA6ICdpZGxlJ308L2Rpdj5cclxuICAgICAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImxvYWRlZFwiPntsb2FkZWQgPyAneWVzJyA6ICdubyd9PC9kaXY+XHJcbiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17bG9hZEFsbH0+TG9hZCBBbGw8L2J1dHRvbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcclxuXHJcbiAgICAgIHJlbmRlcihcclxuICAgICAgICA8QXBwUHJvdmlkZXI+XHJcbiAgICAgICAgICA8VGVzdEFwcCAvPlxyXG4gICAgICAgIDwvQXBwUHJvdmlkZXI+XHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBUcmlnZ2VyIG11bHRpcGxlIGxvYWRzXHJcbiAgICAgIGF3YWl0IHVzZXIuY2xpY2soc2NyZWVuLmdldEJ5VGV4dCgnTG9hZCBBbGwnKSk7XHJcblxyXG4gICAgICAvLyBWZXJpZnkgYWxsIEFQSXMgd2VyZSBjYWxsZWRcclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KG1vY2tUcmFuc2FjdGlvbkFwaS5nZXRBbGwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICBleHBlY3QobW9ja0NhdGVnb3J5QXBpLmdldEFsbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIGV4cGVjdChtb2NrQnVkZ2V0QXBpLmdldEFsbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2xvYWRlZCcpKS50b0hhdmVUZXh0Q29udGVudCgneWVzJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJtb2NrVHJhbnNhY3Rpb25BcGkiLCJ0cmFuc2FjdGlvbkFwaSIsIm1vY2tDYXRlZ29yeUFwaSIsImNhdGVnb3J5QXBpIiwibW9ja0J1ZGdldEFwaSIsImJ1ZGdldEFwaSIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJpdCIsIm1vY2tUcmFuc2FjdGlvbnMiLCJBcnJheSIsImZyb20iLCJsZW5ndGgiLCJfIiwiaSIsImlkIiwidHlwZSIsImFtb3VudCIsImN1cnJlbmN5IiwiY2F0ZWdvcnlJZCIsImRlc2NyaXB0aW9uIiwidHJhbnNhY3Rpb25EYXRlIiwiaXNSZWN1cnJpbmciLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJjYXRlZ29yeSIsIm5hbWUiLCJjb2xvciIsImdldEFsbCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZGF0YSIsInBhZ2luYXRpb24iLCJwYWdlIiwicGFnZVNpemUiLCJ0b3RhbFBhZ2VzIiwidG90YWxJdGVtcyIsIlRlc3RBcHAiLCJsb2FkVHJhbnNhY3Rpb25zIiwidHJhbnNhY3Rpb25zIiwidXNlQXBwIiwiZmlsdGVycyIsInNldEZpbHRlcnMiLCJSZWFjdCIsInVzZVN0YXRlIiwic2V0UGFnZSIsInVzZUVmZmVjdCIsImRpdiIsImRhdGEtdGVzdGlkIiwiYnV0dG9uIiwib25DbGljayIsInVzZXIiLCJ1c2VyRXZlbnQiLCJzZXR1cCIsInJlbmRlciIsIkFwcFByb3ZpZGVyIiwid2FpdEZvciIsImV4cGVjdCIsInNjcmVlbiIsImdldEJ5VGVzdElkIiwidG9IYXZlVGV4dENvbnRlbnQiLCJjbGljayIsImdldEJ5VGV4dCIsInRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aCIsIm9iamVjdENvbnRhaW5pbmciLCJtb2NrVHJhbnNhY3Rpb24iLCJjcmVhdGUiLCJjcmVhdGVUcmFuc2FjdGlvbiIsImRlbGV0ZSIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJkZWxldGVUcmFuc2FjdGlvbiIsImVycm9yIiwiY2F0Y2giLCJtb2NrUmVqZWN0ZWRWYWx1ZU9uY2UiLCJtb2NrUmVzb2x2ZWRWYWx1ZU9uY2UiLCJjbGVhckVycm9yIiwibW9ja0NhdGVnb3JpZXMiLCJsb2FkQ2F0ZWdvcmllcyIsImxvYWRCdWRnZXRzIiwibG9hZGluZyIsImxvYWRlZCIsInNldExvYWRlZCIsImxvYWRBbGwiLCJQcm9taXNlIiwiYWxsIiwidG9IYXZlQmVlbkNhbGxlZCJdLCJt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