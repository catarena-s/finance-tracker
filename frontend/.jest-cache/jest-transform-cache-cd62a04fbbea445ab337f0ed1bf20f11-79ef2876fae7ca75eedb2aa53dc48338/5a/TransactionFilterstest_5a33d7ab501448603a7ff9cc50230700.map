{"version":3,"sources":["E:\\my\\otus\\finance_tracker\\frontend\\__tests__\\components\\TransactionFilters.test.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport \"@testing-library/jest-dom\";\r\nimport { TransactionFilters } from \"@/components/transactions/TransactionFilters\";\r\nimport { Category } from \"@/types/api\";\r\n\r\nconst mockCategories: Category[] = [\r\n  {\r\n    id: \"cat-1\",\r\n    name: \"Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°\",\r\n    icon: \"ðŸ’°\",\r\n    type: \"income\",\r\n    color: \"#00B894\",\r\n    createdAt: \"2024-01-01\",\r\n    updatedAt: \"2024-01-01\",\r\n  },\r\n  {\r\n    id: \"cat-2\",\r\n    name: \"ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹\",\r\n    icon: \"ðŸ›’\",\r\n    type: \"expense\",\r\n    color: \"#FF6B6B\",\r\n    createdAt: \"2024-01-01\",\r\n    updatedAt: \"2024-01-01\",\r\n  },\r\n  {\r\n    id: \"cat-3\",\r\n    name: \"Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚\",\r\n    icon: \"ðŸš—\",\r\n    type: \"expense\",\r\n    color: \"#4ECDC4\",\r\n    createdAt: \"2024-01-01\",\r\n    updatedAt: \"2024-01-01\",\r\n  },\r\n];\r\n\r\ndescribe(\"TransactionFilters\", () => {\r\n  it(\"filters categories by selected type\", async () => {\r\n    const onFilterChange = jest.fn();\r\n    const { container } = render(\r\n      <TransactionFilters categories={mockCategories} onFilterChange={onFilterChange} />\r\n    );\r\n\r\n    // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð²ÑÐµ ÑÐµÐ»ÐµÐºÑ‚Ñ‹\r\n    const selects = container.querySelectorAll(\"select\");\r\n    const typeSelect = selects[0] as HTMLSelectElement;\r\n    const categorySelect = selects[1] as HTMLSelectElement;\r\n\r\n    // ÐœÐµÐ½ÑÐµÐ¼ Ñ‚Ð¸Ð¿ Ð½Ð° \"expense\"\r\n    fireEvent.change(typeSelect, { target: { value: \"expense\" } });\r\n\r\n    await waitFor(() => {\r\n      // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ onFilterChange Ð±Ñ‹Ð» Ð²Ñ‹Ð·Ð²Ð°Ð½ Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸\r\n      const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n      expect(lastCall.type).toBe(\"expense\");\r\n    });\r\n\r\n    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð² ÑÐµÐ»ÐµÐºÑ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ expense ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸\r\n    const options = Array.from(categorySelect.options).map((opt) => opt.text);\r\n    \r\n    // Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ: \"Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸\", \"ðŸ›’ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹\", \"ðŸš— Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚\"\r\n    expect(options).toContain(\"Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸\");\r\n    expect(options).toContain(\"ðŸ›’ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹\");\r\n    expect(options).toContain(\"ðŸš— Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚\");\r\n    expect(options).not.toContain(\"ðŸ’° Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°\");\r\n  });\r\n\r\n  it(\"sets type automatically when category is selected\", async () => {\r\n    const onFilterChange = jest.fn();\r\n    const { container } = render(\r\n      <TransactionFilters categories={mockCategories} onFilterChange={onFilterChange} />\r\n    );\r\n\r\n    // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ ÑÐµÐ»ÐµÐºÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸\r\n    const categorySelect = container.querySelectorAll(\"select\")[1] as HTMLSelectElement;\r\n\r\n    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ \"ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹\" (expense)\r\n    fireEvent.change(categorySelect, { target: { value: \"cat-2\" } });\r\n\r\n    await waitFor(() => {\r\n      const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n      expect(lastCall.categoryId).toBe(\"cat-2\");\r\n      expect(lastCall.type).toBe(\"expense\");\r\n    });\r\n  });\r\n\r\n  it(\"clears incompatible category when type changes\", async () => {\r\n    const onFilterChange = jest.fn();\r\n    const { container } = render(\r\n      <TransactionFilters categories={mockCategories} onFilterChange={onFilterChange} />\r\n    );\r\n\r\n    const selects = container.querySelectorAll(\"select\");\r\n    const typeSelect = selects[0] as HTMLSelectElement;\r\n    const categorySelect = selects[1] as HTMLSelectElement;\r\n\r\n    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ \"ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹\" (expense)\r\n    fireEvent.change(categorySelect, { target: { value: \"cat-2\" } });\r\n\r\n    await waitFor(() => {\r\n      const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n      expect(lastCall.categoryId).toBe(\"cat-2\");\r\n      expect(lastCall.type).toBe(\"expense\");\r\n    });\r\n\r\n    // ÐœÐµÐ½ÑÐµÐ¼ Ñ‚Ð¸Ð¿ Ð½Ð° \"income\"\r\n    fireEvent.change(typeSelect, { target: { value: \"income\" } });\r\n\r\n    await waitFor(() => {\r\n      const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n      expect(lastCall.type).toBe(\"income\");\r\n      expect(lastCall.categoryId).toBeUndefined(); // ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ‚ÑŒÑÑ\r\n    });\r\n  });\r\n\r\n  it(\"does not send empty type to backend\", async () => {\r\n    const onFilterChange = jest.fn();\r\n    const { container } = render(\r\n      <TransactionFilters categories={mockCategories} onFilterChange={onFilterChange} />\r\n    );\r\n\r\n    // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ ÑÐµÐ»ÐµÐºÑ‚ Ñ‚Ð¸Ð¿Ð°\r\n    const selects = container.querySelectorAll(\"select\");\r\n    const typeSelect = selects[0] as HTMLSelectElement;\r\n\r\n    // ÐœÐµÐ½ÑÐµÐ¼ Ñ‚Ð¸Ð¿ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¾ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð¾)\r\n    fireEvent.change(typeSelect, { target: { value: \"\" } });\r\n\r\n    await waitFor(() => {\r\n      if (onFilterChange.mock.calls.length > 0) {\r\n        const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ type Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°ÐµÑ‚ÑÑ ÐµÑÐ»Ð¸ Ð¿ÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°\r\n        expect(lastCall.type).toBeUndefined();\r\n      }\r\n    });\r\n  });\r\n\r\n  it(\"sends type filter to backend when selected\", async () => {\r\n    const onFilterChange = jest.fn();\r\n    const { container } = render(\r\n      <TransactionFilters categories={mockCategories} onFilterChange={onFilterChange} />\r\n    );\r\n\r\n    const selects = container.querySelectorAll(\"select\");\r\n    const typeSelect = selects[0] as HTMLSelectElement;\r\n    \r\n    fireEvent.change(typeSelect, { target: { value: \"income\" } });\r\n\r\n    await waitFor(() => {\r\n      const lastCall = onFilterChange.mock.calls[onFilterChange.mock.calls.length - 1][0];\r\n      expect(lastCall.type).toBe(\"income\");\r\n    });\r\n  });\r\n});\r\n"],"names":["mockCategories","id","name","icon","type","color","createdAt","updatedAt","describe","it","onFilterChange","jest","fn","container","render","TransactionFilters","categories","selects","querySelectorAll","typeSelect","categorySelect","fireEvent","change","target","value","waitFor","lastCall","mock","calls","length","expect","toBe","options","Array","from","map","opt","text","toContain","not","categoryId","toBeUndefined"],"mappings":"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"}