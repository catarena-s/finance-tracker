{"version":3,"sources":["E:\\my\\otus\\finance_tracker\\frontend\\__tests__\\api\\analytics.test.ts"],"sourcesContent":["/**\r\n * Unit tests — analytics API\r\n * top_categories в ответе, period и currency в запросах.\r\n */\r\nimport { analyticsApi } from \"@/services/api/analytics\";\r\n\r\nconst mockGet = jest.fn();\r\njest.mock(\"@/services/api/client\", () => ({\r\n  apiClient: {\r\n    get: (...args: unknown[]) => mockGet(...args),\r\n  },\r\n}));\r\n\r\ndescribe(\"analyticsApi\", () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it(\"getTrends sends period and currency in query when provided\", async () => {\r\n    mockGet.mockResolvedValue({\r\n      data: { trends: [{ month: \"2025-01\", income: \"100\", expense: \"50\" }] },\r\n    });\r\n    await analyticsApi.getTrends({\r\n      period: \"day\",\r\n      startDate: \"2025-01-01\",\r\n      endDate: \"2025-01-31\",\r\n      currency: \"RUB\",\r\n    });\r\n    expect(mockGet).toHaveBeenCalledWith(\r\n      expect.stringContaining(\"period=day\")\r\n    );\r\n    expect(mockGet).toHaveBeenCalledWith(\r\n      expect.stringContaining(\"currency=RUB\")\r\n    );\r\n  });\r\n\r\n  it(\"getSummary sends currency in query when provided\", async () => {\r\n    mockGet.mockResolvedValue({\r\n      data: {\r\n        total_income: 100,\r\n        total_expense: 50,\r\n        balance: 50,\r\n        by_currency: [],\r\n      },\r\n    });\r\n    await analyticsApi.getSummary({\r\n      startDate: \"2025-01-01\",\r\n      endDate: \"2025-01-31\",\r\n      currency: \"EUR\",\r\n    });\r\n    expect(mockGet).toHaveBeenCalledWith(\r\n      expect.stringContaining(\"currency=EUR\")\r\n    );\r\n  });\r\n\r\n  it(\"getTopCategories maps top_categories and computes percentage\", async () => {\r\n    mockGet.mockResolvedValue({\r\n      data: {\r\n        top_categories: [\r\n          { category: \"Еда\", amount: \"300\" },\r\n          { category: \"Транспорт\", amount: \"200\" },\r\n        ],\r\n      },\r\n    });\r\n    const result = await analyticsApi.getTopCategories({\r\n      limit: 5,\r\n      startDate: \"2025-01-01\",\r\n      endDate: \"2025-01-31\",\r\n    });\r\n    expect(result).toHaveLength(2);\r\n    expect(result[0].categoryName).toBe(\"Еда\");\r\n    expect(result[0].totalAmount).toBe(300);\r\n    expect(result[0].percentage).toBe(60); // 300/500\r\n    expect(result[1].percentage).toBe(40);\r\n  });\r\n});\r\n"],"names":["jest","mock","apiClient","get","args","mockGet","fn","describe","beforeEach","clearAllMocks","it","mockResolvedValue","data","trends","month","income","expense","analyticsApi","getTrends","period","startDate","endDate","currency","expect","toHaveBeenCalledWith","stringContaining","total_income","total_expense","balance","by_currency","getSummary","top_categories","category","amount","result","getTopCategories","limit","toHaveLength","categoryName","toBe","totalAmount","percentage"],"mappings":"AAAA;;;CAGC;AAIDA,KAAKC,IAAI,CAAC,yBAAyB,IAAO,CAAA;QACxCC,WAAW;YACTC,KAAK,CAAC,GAAGC,OAAoBC,WAAWD;QAC1C;IACF,CAAA;;;;2BAP6B;AAE7B,MAAMC,UAAUL,KAAKM,EAAE;AAOvBC,SAAS,gBAAgB;IACvBC,WAAW;QACTR,KAAKS,aAAa;IACpB;IAEAC,GAAG,8DAA8D;QAC/DL,QAAQM,iBAAiB,CAAC;YACxBC,MAAM;gBAAEC,QAAQ;oBAAC;wBAAEC,OAAO;wBAAWC,QAAQ;wBAAOC,SAAS;oBAAK;iBAAE;YAAC;QACvE;QACA,MAAMC,uBAAY,CAACC,SAAS,CAAC;YAC3BC,QAAQ;YACRC,WAAW;YACXC,SAAS;YACTC,UAAU;QACZ;QACAC,OAAOlB,SAASmB,oBAAoB,CAClCD,OAAOE,gBAAgB,CAAC;QAE1BF,OAAOlB,SAASmB,oBAAoB,CAClCD,OAAOE,gBAAgB,CAAC;IAE5B;IAEAf,GAAG,oDAAoD;QACrDL,QAAQM,iBAAiB,CAAC;YACxBC,MAAM;gBACJc,cAAc;gBACdC,eAAe;gBACfC,SAAS;gBACTC,aAAa,EAAE;YACjB;QACF;QACA,MAAMZ,uBAAY,CAACa,UAAU,CAAC;YAC5BV,WAAW;YACXC,SAAS;YACTC,UAAU;QACZ;QACAC,OAAOlB,SAASmB,oBAAoB,CAClCD,OAAOE,gBAAgB,CAAC;IAE5B;IAEAf,GAAG,gEAAgE;QACjEL,QAAQM,iBAAiB,CAAC;YACxBC,MAAM;gBACJmB,gBAAgB;oBACd;wBAAEC,UAAU;wBAAOC,QAAQ;oBAAM;oBACjC;wBAAED,UAAU;wBAAaC,QAAQ;oBAAM;iBACxC;YACH;QACF;QACA,MAAMC,SAAS,MAAMjB,uBAAY,CAACkB,gBAAgB,CAAC;YACjDC,OAAO;YACPhB,WAAW;YACXC,SAAS;QACX;QACAE,OAAOW,QAAQG,YAAY,CAAC;QAC5Bd,OAAOW,MAAM,CAAC,EAAE,CAACI,YAAY,EAAEC,IAAI,CAAC;QACpChB,OAAOW,MAAM,CAAC,EAAE,CAACM,WAAW,EAAED,IAAI,CAAC;QACnChB,OAAOW,MAAM,CAAC,EAAE,CAACO,UAAU,EAAEF,IAAI,CAAC,KAAK,UAAU;QACjDhB,OAAOW,MAAM,CAAC,EAAE,CAACO,UAAU,EAAEF,IAAI,CAAC;IACpC;AACF"}