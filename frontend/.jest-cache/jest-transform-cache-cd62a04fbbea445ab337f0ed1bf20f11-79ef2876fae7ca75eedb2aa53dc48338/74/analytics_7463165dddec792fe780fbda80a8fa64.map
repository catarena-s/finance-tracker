{"version":3,"names":["cov_867fva6zw","actualCoverage","s","analyticsApi","getSummary","params","f","queryParams","URLSearchParams","append","startDate","endDate","currency","b","response","_client","apiClient","get","toString","data","getTrends","period","trends","map","t","date","month","income","parseFloat","expense","getTopCategories","limit","type","list","topCategories","top_categories","total","reduce","c","amount","cat","index","totalAmount","categoryId","categoryName","category","categoryIcon","icon","categoryColor","Math","floor","random","transactionCount","percentage"],"sources":["E:\\my\\otus\\finance_tracker\\frontend\\src\\services\\api\\analytics.ts"],"sourcesContent":["import { apiClient } from \"./client\";\nimport {\n  SummaryData,\n  TrendData,\n  CategorySpending,\n  TransactionType,\n  ApiResponse,\n} from \"@/types/api\";\n\nexport interface SummaryParams {\n  startDate: string;\n  endDate: string;\n  currency?: string;\n}\n\nexport interface TrendsParams {\n  period?: \"day\" | \"week\" | \"month\" | \"year\";\n  startDate: string;\n  endDate: string;\n  currency?: string;\n}\n\nexport interface TopCategoriesParams {\n  limit: number;\n  type?: TransactionType;\n  startDate: string;\n  endDate: string;\n}\n\n/**\n * Analytics API клиент\n */\nexport const analyticsApi = {\n  async getSummary(params: SummaryParams): Promise<SummaryData> {\n    const queryParams = new URLSearchParams();\n    queryParams.append(\"start_date\", params.startDate);\n    queryParams.append(\"end_date\", params.endDate);\n    if (params.currency) queryParams.append(\"currency\", params.currency);\n\n    const response = await apiClient.get<SummaryData>(\n      `/analytics/summary?${queryParams.toString()}`\n    );\n    return response.data;\n  },\n\n  async getTrends(params: TrendsParams): Promise<TrendData[]> {\n    const queryParams = new URLSearchParams();\n    queryParams.append(\"start_date\", params.startDate);\n    queryParams.append(\"end_date\", params.endDate);\n    if (params.period) queryParams.append(\"period\", params.period);\n    if (params.currency) queryParams.append(\"currency\", params.currency);\n\n    const response = await apiClient.get<{\n      trends: Array<{\n        month: string;\n        income: string;\n        expense: string;\n        balance: string;\n      }>;\n    }>(`/analytics/trends?${queryParams.toString()}`);\n\n    return response.data.trends.map((t) => ({\n      date: t.month,\n      income: parseFloat(t.income),\n      expense: parseFloat(t.expense),\n    }));\n  },\n\n  async getTopCategories(params: TopCategoriesParams): Promise<CategorySpending[]> {\n    const queryParams = new URLSearchParams();\n    queryParams.append(\"limit\", params.limit.toString());\n    queryParams.append(\"start_date\", params.startDate);\n    queryParams.append(\"end_date\", params.endDate);\n    if (params.type) queryParams.append(\"type\", params.type);\n\n    const response = await apiClient.get<{\n      top_categories?: Array<{ category: string; icon?: string; amount: string }>;\n      topCategories?: Array<{ category: string; icon?: string; amount: string }>;\n    }>(`/analytics/top-categories?${queryParams.toString()}`);\n\n    // Backend возвращает top_categories, но axios может конвертировать в topCategories\n    const list = response.data.topCategories ?? response.data.top_categories ?? [];\n    const total = list.reduce((s, c) => s + parseFloat(c.amount), 0);\n    return list.map((cat, index) => {\n      const totalAmount = parseFloat(cat.amount);\n      return {\n        categoryId: `cat-${index}`,\n        categoryName: cat.category,\n        categoryIcon: cat.icon,\n        categoryColor: \"#\" + Math.floor(Math.random() * 16777215).toString(16),\n        totalAmount,\n        transactionCount: 0,\n        percentage: total > 0 ? (totalAmount / total) * 100 : 0,\n      };\n    });\n  },\n};\n"],"mappings":"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","ignoreList":[]}