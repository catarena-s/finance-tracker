{"version":3,"sources":["E:\\my\\otus\\finance_tracker\\frontend\\__tests__\\integration\\transaction-filtering.test.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport \"@testing-library/jest-dom\";\r\nimport { transactionApi } from \"@/services/api/transactions\";\r\n\r\n// Mock API\r\njest.mock(\"@/services/api/transactions\");\r\n\r\ndescribe(\"Transaction Filtering Integration\", () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it(\"sends correct type filter to API\", async () => {\r\n    const mockGetAll = jest.fn().mockResolvedValue({\r\n      data: [],\r\n      pagination: { page: 1, pageSize: 10, totalPages: 1, totalItems: 0 },\r\n    });\r\n    (transactionApi.getAll as jest.Mock) = mockGetAll;\r\n\r\n    // Вызываем API с фильтром type\r\n    await transactionApi.getAll({ type: \"expense\", page: 1, pageSize: 10 });\r\n\r\n    expect(mockGetAll).toHaveBeenCalledWith({\r\n      type: \"expense\",\r\n      page: 1,\r\n      pageSize: 10,\r\n    });\r\n  });\r\n\r\n  it(\"does not send empty type to API\", async () => {\r\n    const mockGetAll = jest.fn().mockResolvedValue({\r\n      data: [],\r\n      pagination: { page: 1, pageSize: 10, totalPages: 1, totalItems: 0 },\r\n    });\r\n    (transactionApi.getAll as jest.Mock) = mockGetAll;\r\n\r\n    // Вызываем API без фильтра type\r\n    await transactionApi.getAll({ page: 1, pageSize: 10 });\r\n\r\n    expect(mockGetAll).toHaveBeenCalledWith({\r\n      page: 1,\r\n      pageSize: 10,\r\n    });\r\n\r\n    // Проверяем, что type не передается\r\n    const callArgs = mockGetAll.mock.calls[0][0];\r\n    expect(callArgs.type).toBeUndefined();\r\n  });\r\n\r\n  it(\"API constructs correct query string with type filter\", () => {\r\n    const filters = {\r\n      page: 1,\r\n      pageSize: 10,\r\n      type: \"income\" as const,\r\n      startDate: \"2024-01-01\",\r\n      endDate: \"2024-01-31\",\r\n    };\r\n\r\n    const params = new URLSearchParams();\r\n    if (filters.page) params.append(\"page\", filters.page.toString());\r\n    if (filters.pageSize) params.append(\"page_size\", filters.pageSize.toString());\r\n    if (filters.type) params.append(\"type\", filters.type);\r\n    if (filters.startDate) params.append(\"start_date\", filters.startDate);\r\n    if (filters.endDate) params.append(\"end_date\", filters.endDate);\r\n\r\n    const queryString = params.toString();\r\n    \r\n    expect(queryString).toContain(\"type=income\");\r\n    expect(queryString).toContain(\"page=1\");\r\n    expect(queryString).toContain(\"page_size=10\");\r\n    expect(queryString).toContain(\"start_date=2024-01-01\");\r\n    expect(queryString).toContain(\"end_date=2024-01-31\");\r\n  });\r\n});\r\n"],"names":["jest","mock","describe","beforeEach","clearAllMocks","it","mockGetAll","fn","mockResolvedValue","data","pagination","page","pageSize","totalPages","totalItems","transactionApi","getAll","type","expect","toHaveBeenCalledWith","callArgs","calls","toBeUndefined","filters","startDate","endDate","params","URLSearchParams","append","toString","queryString","toContain"],"mappings":";AAKA,WAAW;AACXA,KAAKC,IAAI,CAAC;;;;8DANQ;QAEX;8BACwB;;;;;;AAK/BC,SAAS,qCAAqC;IAC5CC,WAAW;QACTH,KAAKI,aAAa;IACpB;IAEAC,GAAG,oCAAoC;QACrC,MAAMC,aAAaN,KAAKO,EAAE,GAAGC,iBAAiB,CAAC;YAC7CC,MAAM,EAAE;YACRC,YAAY;gBAAEC,MAAM;gBAAGC,UAAU;gBAAIC,YAAY;gBAAGC,YAAY;YAAE;QACpE;QACCC,4BAAc,CAACC,MAAM,GAAiBV;QAEvC,+BAA+B;QAC/B,MAAMS,4BAAc,CAACC,MAAM,CAAC;YAAEC,MAAM;YAAWN,MAAM;YAAGC,UAAU;QAAG;QAErEM,OAAOZ,YAAYa,oBAAoB,CAAC;YACtCF,MAAM;YACNN,MAAM;YACNC,UAAU;QACZ;IACF;IAEAP,GAAG,mCAAmC;QACpC,MAAMC,aAAaN,KAAKO,EAAE,GAAGC,iBAAiB,CAAC;YAC7CC,MAAM,EAAE;YACRC,YAAY;gBAAEC,MAAM;gBAAGC,UAAU;gBAAIC,YAAY;gBAAGC,YAAY;YAAE;QACpE;QACCC,4BAAc,CAACC,MAAM,GAAiBV;QAEvC,gCAAgC;QAChC,MAAMS,4BAAc,CAACC,MAAM,CAAC;YAAEL,MAAM;YAAGC,UAAU;QAAG;QAEpDM,OAAOZ,YAAYa,oBAAoB,CAAC;YACtCR,MAAM;YACNC,UAAU;QACZ;QAEA,oCAAoC;QACpC,MAAMQ,WAAWd,WAAWL,IAAI,CAACoB,KAAK,CAAC,EAAE,CAAC,EAAE;QAC5CH,OAAOE,SAASH,IAAI,EAAEK,aAAa;IACrC;IAEAjB,GAAG,wDAAwD;QACzD,MAAMkB,UAAU;YACdZ,MAAM;YACNC,UAAU;YACVK,MAAM;YACNO,WAAW;YACXC,SAAS;QACX;QAEA,MAAMC,SAAS,IAAIC;QACnB,IAAIJ,QAAQZ,IAAI,EAAEe,OAAOE,MAAM,CAAC,QAAQL,QAAQZ,IAAI,CAACkB,QAAQ;QAC7D,IAAIN,QAAQX,QAAQ,EAAEc,OAAOE,MAAM,CAAC,aAAaL,QAAQX,QAAQ,CAACiB,QAAQ;QAC1E,IAAIN,QAAQN,IAAI,EAAES,OAAOE,MAAM,CAAC,QAAQL,QAAQN,IAAI;QACpD,IAAIM,QAAQC,SAAS,EAAEE,OAAOE,MAAM,CAAC,cAAcL,QAAQC,SAAS;QACpE,IAAID,QAAQE,OAAO,EAAEC,OAAOE,MAAM,CAAC,YAAYL,QAAQE,OAAO;QAE9D,MAAMK,cAAcJ,OAAOG,QAAQ;QAEnCX,OAAOY,aAAaC,SAAS,CAAC;QAC9Bb,OAAOY,aAAaC,SAAS,CAAC;QAC9Bb,OAAOY,aAAaC,SAAS,CAAC;QAC9Bb,OAAOY,aAAaC,SAAS,CAAC;QAC9Bb,OAAOY,aAAaC,SAAS,CAAC;IAChC;AACF"}